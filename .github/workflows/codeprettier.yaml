name: Prettier

on:
  pull_request:
  push:
    branches:
      - "main"

concurrency:
  group: "prettier"
  cancel-in-progress: true

jobs:
  prettier:
    runs-on: ubuntu-latest

    steps:
      - name: Checkoutä»£ç åº“
        uses: actions/checkout@v2
        with:
          ref: main

      - name: è®¾ç½® Node.js ç¯å¢ƒ
        uses: actions/setup-node@v2
        with:
          node-version: "20.x"

      - name: è®¾ç½® pnmp
        uses: pnpm/action-setup@v2
        with:
          version: latest

      - name: å®‰è£… Prettier
        run: pnpm add prettier

      - name: è¿è¡Œ Prettier æ ¼å¼åŒ–
        run: pnpm exec -- prettier --write .

      - name: æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ”¹
        id: check_changes
        run: |
          if git diff --quiet; then
            echo "changes=false" >> $GITHUB_ENV
          else
            echo "changes=true" >> $GITHUB_ENV
          fi

      - name: å¦‚æœæ²¡æœ‰æ›´æ”¹ï¼Œåˆ™è¾“å‡ºæ¶ˆæ¯
        run: echo "æœªæ£€æµ‹åˆ°ä»£ç æ ¼å¼å˜åŒ–ï¼ğŸ‘Œ"
        if: env.changes == 'false'

      - name: æäº¤å’Œæ¨é€æ›´æ”¹
        run: |
          if [ "${{ env.changes }}" == "true" ]; then
            git config user.email "${{ secrets.USER_EMAIL }}"
            git config user.name "${{ secrets.USER_NAME }}"
            git add .
            git commit -m "âœ¨ é€šè¿‡ GitHub Actionsè‡ªåŠ¨è¿›è¡Œæ ¼å¼ä¿®æ­£ ğŸ¤– "
            git push
          fi
